<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENM评价存档 - WP062025 - Enceladus Blog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-color: #f8f9fa; --text-color: #212529; --primary-color: #4a90e2; --secondary-color: #f5a623;
            --card-bg-color: #ffffff; --border-color: #dee2e6; --header-bg: #2c3e50; --header-text: #ecf0f1;
            --text-muted: #6c757d; --card-shadow: rgba(0,0,0,0.05); --article-title-color: #333;
        }
        body.dark-mode {
            --bg-color: #121212; --text-color: #e0e0e0; --primary-color: #58a6ff; --secondary-color: #f7b731;
            --card-bg-color: #1e1e1e; --border-color: #333; --header-bg: #1a202c; --header-text: #e2e8f0;
            --text-muted: #a0aec0; --card-shadow: rgba(0,0,0,0.2); --article-title-color: #f0f0f0;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.7; overflow-x: hidden; position: relative; transition: background-color 0.3s, color 0.3s; }
        
        body::before, body::after { 
            content: ''; 
            position: fixed; 
            z-index: -1; 
            opacity: 0.05; 
            transition: transform 0.5s ease-out, background-color 0.3s, border-color 0.3s; 
        }
        body::before { 
            width: 50vw; 
            height: 50vw; 
            background-color: var(--primary-color);
            border-radius: 50%; 
            top: -20vw; 
            right: -20vw; 
            transform: var(--before-transform, translateY(0)); 
        }

        body::after { width: 0; height: 0; border-style: solid; border-width: 0 0 40vw 40vw; border-color: transparent transparent var(--secondary-color) transparent; bottom: -10vw; left: -10vw; transform: var(--after-transform, rotate(-20deg)); }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .site-header { background-color: var(--header-bg); color: var(--header-text); padding: 2rem 1rem; text-align: center; margin-bottom: 3rem; border-bottom: 5px solid var(--primary-color); position: relative; overflow: hidden; transition: background-color 0.3s; }
        .site-header::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.05) 75%, transparent 75%, transparent); background-size: 40px 40px; z-index: 0; }
        .site-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; position: relative; z-index: 1; }
        .site-nav { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; }
        .site-nav a { color: var(--header-text); text-decoration: none; margin: 0 15px; font-weight: 300; transition: all 0.3s ease; opacity: 0.8; display: inline-block; }
        .site-nav a:hover { color: #fff; opacity: 1; transform: translateY(-3px); }
        .article-card { background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 2.5rem; padding: 2.5rem; box-shadow: 0 4px 15px var(--card-shadow); transition: all 0.3s ease; }
        .article-title { font-size: 2.2rem; margin-bottom: 0.75rem; line-height: 1.3; color: var(--article-title-color); }
        .article-meta { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; transition: all 0.3s ease; }
        .article-content p { margin-bottom: 1.5rem; font-size: 1.1rem; }
        .site-footer { text-align: center; padding: 2rem 1rem; margin-top: 3rem; color: var(--text-muted); border-top: 1px solid var(--border-color); transition: all 0.3s ease; }
        #theme-toggle { background: none; color: var(--header-text); border: 1px solid var(--header-text); padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-family: inherit; font-weight: 300; margin-left: 15px; display: inline-block; opacity: 0.8; transition: all 0.3s ease; }
        #theme-toggle:hover { color: #fff; background-color: var(--primary-color); border-color: var(--primary-color); opacity: 1; transform: translateY(-3px); }
        .chart-wrapper { position: relative; height: 400px; margin: 2rem 0; }
        .raw-data { background-color: var(--bg-color); border: 1px solid var(--border-color); padding: 1rem; border-radius: 8px; font-family: 'Courier New', Courier, monospace; font-size: 0.85rem; white-space: pre; overflow-x: auto; color: var(--text-muted); transition: all 0.3s ease; }
    </style>
</head>
<body>

    <!-- --- 修正: 添加即时主题应用脚本 --- -->
    <script>
        (function() {
            try {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.body.classList.add('dark-mode');
                }
            } catch (e) {
                console.error("Could not access localStorage to set theme.");
            }
        })();
    </script>
    <!-- --- 修正结束 --- -->

    <header class="site-header">
        <div class="container">
            <h1 class="site-title">Enceladus的非财经空间</h1>
            <nav class="site-nav">
                <a href="../index.html">首页</a>
                <a href="../about.html">行情</a>
                <a href="../archive.html">归档</a>
                <a href="../realtime.html">实时</a>
                <button id="theme-toggle">切换模式</button>
            </nav>
        </div>
    </header>

    <main class="container">
        <article class="article-card">
            <h1 class="article-title">ENM评价存档: WP062025 05</h1>
            <p class="article-meta">存档日期: <time datetime="2025-07-28">2025年07月28日</time></p>
            <div class="article-content">
                <p>机器学习工具ENceladus Method对热带气旋 WP062025 的详细评价和分析...</p>
                <div class="chart-wrapper">
                    <canvas id="cycloneChart"></canvas>
                </div>
                
                <h3>原始数据记录</h3>
                <div class="raw-data">
WP, 06, 2025071112, ENM, 32, ADT, 31, AIDT, 35, BST, 30
WP, 06, 2025071118, ENM, 34, ADT, 33, AIDT, 35, BST, 35
WP, 06, 2025071200, ENM, 35, ADT, 32, AIDT, 35, BST, 35
WP, 06, 2025071206, ENM, 45, ADT, 32, AIDT, 36, BST, 35
WP, 06, 2025071212, ENM, 39, ADT, 39, AIDT, 38, BST, 35
WP, 06, 2025071218, ENM, 37, ADT, 35, AIDT, 35, BST, 35
WP, 06, 2025071300, ENM, 43, ADT, 33, AIDT, 36, BST, 35
WP, 06, 2025071306, ENM, 48, ADT, 33, AIDT, 35, BST, 40
WP, 06, 2025071312, ENM, 46, ADT, 33, AIDT, 36, BST, 50
WP, 06, 2025071318, ENM, 59, ADT, 35, AIDT, 38, BST, 55
WP, 06, 2025071400, ENM, 53, ADT, 37, AIDT, 38, BST, 45
WP, 06, 2025071406, ENM, 47, ADT, 30, AIDT, 37, BST, 45
WP, 06, 2025071412, ENM, 40, ADT, 25, AIDT, 37, BST, 40
WP, 06, 2025071418, ENM, 35, ADT, 25, AIDT, 38, BST, 35
WP, 06, 2025071500, ENM, 32, ADT, 25, AIDT, 38, BST, 30
                </div>
            </div>
        </article>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 Enceladus. All Rights Reserved.</p>
    </footer>

    <script>
        (function() {
            // --- 滚动效果 ---
            window.addEventListener('scroll', () => window.requestAnimationFrame(() => {
                const scrollY = window.scrollY;
                document.body.style.setProperty('--before-transform', `translateY(${scrollY * 0.1}px)`);
                document.body.style.setProperty('--after-transform', `translateY(${scrollY * 0.2}px) rotate(-20deg)`);
            }));
            
            // --- 图表绘制逻辑 ---
            const rawData = `
WP, 06, 2025071112, ENM, 32, ADT, 31, AIDT, 35, BST, 30
WP, 06, 2025071118, ENM, 34, ADT, 33, AIDT, 35, BST, 35
WP, 06, 2025071200, ENM, 35, ADT, 32, AIDT, 35, BST, 35
WP, 06, 2025071206, ENM, 45, ADT, 32, AIDT, 36, BST, 35
WP, 06, 2025071212, ENM, 39, ADT, 39, AIDT, 38, BST, 35
WP, 06, 2025071218, ENM, 37, ADT, 35, AIDT, 35, BST, 35
WP, 06, 2025071300, ENM, 43, ADT, 33, AIDT, 36, BST, 35
WP, 06, 2025071306, ENM, 48, ADT, 33, AIDT, 35, BST, 40
WP, 06, 2025071312, ENM, 46, ADT, 33, AIDT, 36, BST, 50
WP, 06, 2025071318, ENM, 59, ADT, 35, AIDT, 38, BST, 55
WP, 06, 2025071400, ENM, 53, ADT, 37, AIDT, 38, BST, 45
WP, 06, 2025071406, ENM, 47, ADT, 30, AIDT, 37, BST, 45
WP, 06, 2025071412, ENM, 40, ADT, 25, AIDT, 37, BST, 40
WP, 06, 2025071418, ENM, 35, ADT, 25, AIDT, 38, BST, 35
WP, 06, 2025071500, ENM, 32, ADT, 25, AIDT, 38, BST, 30
            `.trim();

            const labels = [];
            const enmData = [], adtData = [], aidtData = [], bstData = [];

            rawData.split('\n').forEach(line => {
                const parts = line.split(',').map(p => p.trim());
                const timestamp = parts[2];
                labels.push(`${timestamp.substring(4, 6)}/${timestamp.substring(6, 8)} ${timestamp.substring(8, 10)}Z`);
                enmData.push(parseInt(parts[4]));
                adtData.push(parseInt(parts[6]));
                aidtData.push(parseInt(parts[8]));
                bstData.push(parseInt(parts[10]));
            });

            // --- 新增: 从标题中提取气旋信息 ---
            const titleElement = document.querySelector('.article-title');
            const titleText = titleElement ? titleElement.textContent : '';
            const match = titleText.match(/WP\d{2}(\d{4})\s+(\d{2})/);
            const cycloneYear = match ? match[1] : '2025';
            const cycloneNumber = match ? match[2] : '05';

            const ctx = document.getElementById('cycloneChart');
            if (ctx) {
                const cycloneChart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'ENM', data: enmData, borderColor: '#e74c3c', borderWidth: 2.5, tension: 0.1, pointRadius: 3, pointHoverRadius: 6 },
                            { label: 'ADT', data: adtData, borderColor: '#3498db', borderWidth: 1.5, tension: 0.1, pointRadius: 3, pointHoverRadius: 6 },
                            { label: 'AIDT', data: aidtData, borderColor: '#f1c40f', borderWidth: 1.5, tension: 0.1, pointRadius: 3, pointHoverRadius: 6 },
                            { label: 'BST', data: bstData, borderColor: '#2ecc71', borderWidth: 2, borderDash: [5, 5], tension: 0.1, pointRadius: 3, pointHoverRadius: 6 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        // --- 新增: 点击事件处理 ---
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const elementIndex = elements[0].index;
                                const fullTimestamp = fullTimestamps[elementIndex];
                                const mmddhh = fullTimestamp.substring(4); // 提取 MMDDHH
                                
                                const imageUrl = `https://agora.ex.nii.ac.jp/digital-typhoon/wnp/by-name/${cycloneYear}${cycloneNumber}/2/512x512/HMW925${mmddhh}.${cycloneYear}${cycloneNumber}.jpg`;
                                
                                const wrapper = document.getElementById('image-display-wrapper');
                                const img = document.getElementById('satellite-image');
                                const timestampP = document.getElementById('image-timestamp');

                                img.src = imageUrl;
                                timestampP.textContent = `卫星云图: ${labels[elementIndex]}`;
                                wrapper.style.display = 'block';

                                img.onerror = () => {
                                    img.alt = `无法加载 ${labels[elementIndex]} 的卫星云图`;
                                    timestampP.textContent = `无法加载 ${labels[elementIndex]} 的卫星云图`;
                                };
                            }
                        },
                        plugins: {
                            title: { display: true, text: `WP${cycloneNumber}${cycloneYear} 强度分析对比 (单位: KT)`, font: { size: 16 } },
                            tooltip: { mode: 'index', intersect: false },
                            legend: { position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: '强度 (Knots)' } },
                            x: { title: { display: true, text: '时间 (月/日 时Z)' } }
                        }
                    }
                });

                const themeToggle = document.getElementById('theme-toggle');
                const body = document.body;

                const applyChartTheme = (theme) => {
                    if (!cycloneChart) return;
                    const isDark = theme === 'dark';
                    const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                    const tickColor = isDark ? '#bbb' : '#666';
                    const titleColor = isDark ? '#e0e0e0' : '#212529';
                    
                    cycloneChart.options.scales.x.grid.color = gridColor;
                    cycloneChart.options.scales.y.grid.color = gridColor;
                    cycloneChart.options.scales.x.ticks.color = tickColor;
                    cycloneChart.options.scales.y.ticks.color = tickColor;
                    cycloneChart.options.scales.x.title.color = tickColor;
                    cycloneChart.options.scales.y.title.color = tickColor;
                    cycloneChart.options.plugins.legend.labels.color = tickColor;
                    cycloneChart.options.plugins.title.color = titleColor;
                    cycloneChart.update();
                };

                const applyTheme = (theme) => {
                    if (theme === 'dark') {
                        body.classList.add('dark-mode');
                        themeToggle.textContent = '日间模式';
                    } else {
                        body.classList.remove('dark-mode');
                        themeToggle.textContent = '黑夜模式';
                    }
                    applyChartTheme(theme);
                };

                themeToggle.addEventListener('click', () => {
                    const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
                    applyTheme(newTheme);
                    try { localStorage.setItem('theme', newTheme); } catch (e) { console.error("无法访问 localStorage:", e); }
                });

                let initialTheme = 'light';
                try {
                    const savedTheme = localStorage.getItem('theme');
                    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (savedTheme) { initialTheme = savedTheme; } else if (prefersDark) { initialTheme = 'dark'; }
                } catch (e) { console.error("无法访问 localStorage:", e); }
                applyTheme(initialTheme);
            }
        })();
    </script>

</body>
</html>
